<!DOCTYPE html>
<html>
<head>
    <title> Mappa incidenza italiana a livello provinciale  dei Dati DPC sul COVID-19 </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="css/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="css/leaflet-sidebar.css"/>
    <link rel="stylesheet" href="css/L.Control.Locate.min.css" />
    <link rel="stylesheet" href="css/leaflet-control-credits.css" />
    <link rel="stylesheet" href="css/leaflet.infoButton.css" />


<style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            width: 100vw;
        }



sublegend-color {
    width: 20px;
    border: 1px solid #666666;
    display: inline-block;
    opacity: 0.5;
}

.sublegend-item {
    padding-top: 0.2em;
}

.sublegend {
    list-style: none;
    padding-inline-start: 24px;
    margin-top: 0px;
}

    </style>
    <script type="text/javascript" src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.js"></script>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" ></script>
    <script src="js/leaflet-sidebar.js"></script>
    <script src="js/leaflet.awesome-markers.min.js"></script>
    <script src="js/L.Control.Locate.js" ></script>
    <script src="js/choropleth.js"></script>
    <script src="js/leaflet-panel-layers.min.js"></script>
    <script src="js/legendfuncts.js"></script>
    <script src="js/leaflet-control-credits.js"></script>
    <script src="js/leaflet.infoButton.js"></script>
 </head>
<body>
<div id="map"></div>

<script>

var map= L.map('map', {
		center: [41.7, 11.3],
		zoom: 5
	});

OpenStreetMap_Mapnik.addTo(map);

$.getJSON('./data/mappe_light.geojson', function (geojson) {
    var layer_popolazione = L.choropleth(geojson, {
        valueProperty: 'Popolazione',
        scale: ['white', 'red'], // chroma.js scale - include as many as you like
	steps: 7, // number of breaks or steps in range
	mode: 'q', // q for quantile, e for equidistant, k for k-means
	 style: {
            color: '#fff', // border color
            weight: 2,
            fillOpacity: 0.6
        },
    onEachFeature: function (feature, layer) {
      layer.bindPopup(
	  '<strong>Provincia<strong> : '  + feature.properties.prov_name + '<br>' +
          '<strong>Regione<strong> : '    + feature.properties.reg_name  +  '<br>' +
          '<strong>Popolazione<strong> : ' +  feature.properties.Popolazione + '<br>' +
          '<strong>Totale casi<strong> : ' + feature.properties.casi     +     '<br>' +
          '<strong>Nuovi casi<strong> : ' + feature.properties.nuovi_casi + '<br>' +
          '<strong>Incidenza su popolazione (% pop) <strong> : ' + feature.properties.Cov19_Inc + '<br>' +
          '<strong>Tasso nuovi casi giornalieri (% casi) <strong> : '+ feature.properties.Delta_day )

    }
    });

   var layer_casi = L.choropleth(geojson, {
        valueProperty: 'casi',
        scale: ['blue','white','red'], // chroma.js scale - include as many as you like
	steps: 7, // number of breaks or steps in range
	mode: 'q', // q for quantile, e for equidistant, k for k-means
	 style: {
            color: '#fff', // border color
            weight: 2,
            fillOpacity: 0.6
        },
    onEachFeature: function (feature, layer) {
      layer.bindPopup(
	  '<strong>Provincia<strong> : '  + feature.properties.prov_name + '<br>' +
          '<strong>Regione<strong> : '    + feature.properties.reg_name  +  '<br>' +
          '<strong>Popolazione<strong> : ' +  feature.properties.Popolazione + '<br>' +
          '<strong>Totale casi<strong> : ' + feature.properties.casi     +     '<br>' +
          '<strong>Nuovi casi<strong> : ' + feature.properties.nuovi_casi + '<br>' +
          '<strong>Incidenza su popolazione (% pop) <strong> : ' + feature.properties.Cov19_Inc + '<br>' +
          '<strong>Tasso nuovi casi giornalieri (% casi) <strong> : '+ feature.properties.Delta_day )
    }
    });


  var layer_nuovi_casi = L.choropleth(geojson, {
        valueProperty: 'nuovi_casi',
        scale: ['blue','yellow','red'], // chroma.js scale - include as many as you like
	steps: 7, // number of breaks or steps in range
	mode: 'q', // q for quantile, e for equidistant, k for k-means
	 style: {
            color: '#fff', // border color
            weight: 2,
            fillOpacity: 0.6
        },
    onEachFeature: function (feature, layer) {
      layer.bindPopup(
	  '<strong>Provincia<strong> : '  + feature.properties.prov_name + '<br>' +
          '<strong>Regione<strong> : '    + feature.properties.reg_name  +  '<br>' +
          '<strong>Popolazione<strong> : ' +  feature.properties.Popolazione + '<br>' +
          '<strong>Totale casi<strong> : ' + feature.properties.casi     +     '<br>' +
          '<strong>Nuovi casi<strong> : ' + feature.properties.nuovi_casi + '<br>' +
          '<strong>Incidenza su popolazione (% pop) <strong> : ' + feature.properties.Cov19_Inc + '<br>' +
          '<strong>Tasso nuovi casi giornalieri (% casi) <strong> : '+ feature.properties.Delta_day )
    }
    }).addTo(map);

 var layer_incidenza = L.choropleth(geojson, {
        valueProperty: 'Cov19_Inc',
        scale: ['white','darkgray'], // chroma.js scale - include as many as you like
	steps: 5, // number of breaks or steps in range
	mode: 'e', // q for quantile, e for equidistant, k for k-means
	 style: {
            color: '#fff', // border color
            weight: 2,
            fillOpacity: 0.6
        },
    onEachFeature: function (feature, layer) {
      layer.bindPopup(
	  '<strong>Provincia<strong> : '  + feature.properties.prov_name + '<br>' +
          '<strong>Regione<strong> : '    + feature.properties.reg_name  +  '<br>' +
          '<strong>Popolazione<strong> : ' +  feature.properties.Popolazione + '<br>' +
          '<strong>Totale casi<strong> : ' + feature.properties.casi     +     '<br>' +
          '<strong>Nuovi casi<strong> : ' + feature.properties.nuovi_casi + '<br>' +
          '<strong>Incidenza su popolazione (% pop) <strong> : ' + feature.properties.Cov19_Inc + '<br>' +
          '<strong>Tasso nuovi casi giornalieri (% casi) <strong> : '+ feature.properties.Delta_day )
    }
    });


 var layer_delta_day = L.choropleth(geojson, {
        valueProperty: 'Delta_day',
        scale: ['white','darkblue'], // chroma.js scale - include as many as you like
	steps: 5, // number of breaks or steps in range
	mode: 'q', // q for quantile, e for equidistant, k for k-means
	 style: {
            color: '#fff', // border color
            weight: 2,
            fillOpacity: 0.6
        },
    onEachFeature: function (feature, layer) {
      layer.bindPopup(
	  '<strong>Provincia<strong> : '  + feature.properties.prov_name + '<br>' +
          '<strong>Regione<strong> : '    + feature.properties.reg_name  +  '<br>' +
          '<strong>Popolazione<strong> : ' +  feature.properties.Popolazione + '<br>' +
          '<strong>Totale casi<strong> : ' + feature.properties.casi     +     '<br>' +
          '<strong>Nuovi casi<strong> : ' + feature.properties.nuovi_casi + '<br>' +
          '<strong>Incidenza su popolazione (% pop) <strong> : ' + feature.properties.Cov19_Inc + '<br>' +
          '<strong>Tasso nuovi casi giornalieri (% casi) <strong> : '+ feature.properties.Delta_day )
    }
    });


/////////////////////////////////////////////////////////////////////////////////////////////////////////////

  layer_nuovi_casi.on('add', function () {
        // Need setTimeout so that we don't get multiple
        // onadd/onremove events raised
        setTimeout(function () {
            $('#legend_nuovi_casi').show();
        });
    });

   layer_nuovi_casi.on('remove', function () {
        // Need setTimeout so that we don't get multiple
        // onadd/onremove events raised
        setTimeout(function () {
            $('#legend_nuovi_casi').hide();
        });
    });

  layer_incidenza.on('add', function () {
        // Need setTimeout so that we don't get multiple
        // onadd/onremove events raised
        setTimeout(function () {
            $('#legend_incidenza').show();
        });
    });

   layer_incidenza.on('remove', function () {
        // Need setTimeout so that we don't get multiple
        // onadd/onremove events raised
        setTimeout(function () {
            $('#legend_incidenza').hide();
        });
    });

  layer_delta_day.on('add', function () {
        // Need setTimeout so that we don't get multiple
        // onadd/onremove events raised
        setTimeout(function () {
            $('#legend_delta_day').show();
        });
    });

    layer_delta_day.on('remove', function () {
        // Need setTimeout so that we don't get multiple
        // onadd/onremove events raised
        setTimeout(function () {
            $('#legend_delta_day').hide();
        });
    });

    layer_popolazione.on('add', function () {
        // Need setTimeout so that we don't get multiple
        // onadd/onremove events raised
        setTimeout(function () {
            $('#legend_pop').show();
        });
    });

    layer_popolazione.on('remove', function () {
        // Need setTimeout so that we don't get multiple
        // onadd/onremove events raised
        setTimeout(function () {
            $('#legend_pop').hide();
        });
    });

  layer_casi.on('add', function () {
        // Need setTimeout so that we don't get multiple
        // onadd/onremove events raised
        setTimeout(function () {
            $('#legend_casi').show();

        });
    });
    layer_casi.on('remove', function () {
        // Need setTimeout so that we don't get multiple
        // onadd/onremove events raised
        setTimeout(function () {
            $('#legend_casi').hide();
        });
    });
//////////////////////////////////////////////////////////////////////////////////////////////////////////

var baselayers = {  "Satellite EsriWorld": Esri_WorldImagery     };

var layers = { [legend_for_choropleth_layer(layer_nuovi_casi, 'Nuovi Casi', '', 'legend_nuovi_casi')]: layer_nuovi_casi,
	             [legend_for_choropleth_layer(layer_incidenza, 'Incidenza (% della popolzione)', '', 'legend_incidenza')]: layer_incidenza,
	             [legend_for_choropleth_layer(layer_delta_day, 'Variazione giorno (% tot casi)', '', 'legend_delta_day')]: layer_delta_day,
	             [legend_for_choropleth_layer(layer_casi, 'Totale casi', '', 'legend_casi')]: layer_casi,
	             [legend_for_choropleth_layer(layer_popolazione, 'Popolazione', '', 'legend_pop')]: layer_popolazione,
             };

var layersControl = L.control.layers(baselayers, layers,{ collapsed: true }).addTo(map);

L.control.locate({strings: { title: "Si sono qui!" }}).addTo(map);

var infoButton = L.control.infoButton({linkTitle: 'Informazioni mappa', 
				       title: '<h2>Informazioni mappe</h2>',
				       html:'Oltre al sito del Dipartimento della Protezione Civile per informare 
				             i cittadini e mettere a disposizione i dati raccolti, utili ai soli fini 
				             comunicativi e di informazione, il Dipartimento della Protezione Civile 
				             ha elaborato cruscotti geografico interattivo raggiungibile agli indirizzi 
				             <a href="http://arcg.is/C1unv">DESKTOP</a> (versione desktop) 
				              e <a href="http://arcg.is/081a51" >MOBILE</a> (versione mobile) 
				             e mette a disposizione, con licenza CC-BY-4.0, le seguenti informazioni aggiornate quotidianamente 
				             alle 18:30 (successivamente la conferenza stampa del Capo Dipartimento). 
				             Proponiamo una versione semplificata al livello provinciale dei dati relativi ai dati epidemiologici 
				             puri messi in relazione al dato di popolazione a livello di provincia.</p>
                                             }).addTo(map);

L.controlCredits({
        	image: "./img/logo_CNR.png",
        	link: "https://www.ibe.cnr.it/",
        	text: "Esperimento pubblicazione dati COVID 19 DPC <br/>Istituto per la Bioeconomia"
        }).addTo(map);
});

</script>
</body>
</html>
